/*! jQuery Tree - v0.1.0 - 2012-07-05
* https://github.com/RafalFilipek/jquery.tree
* Copyright (c) 2012 Rafa≈Ç Filipek; Licensed MIT */

// Generated by CoffeeScript 1.3.3
(function() {

  (function($) {
    return $.fn.tree = function(options) {
      if (options == null) {
        options = {};
      }
      options = $.extend({
        'branch': 'ul',
        'node': 'li',
        'branch_class': 'branch',
        'auto_switch_add': false,
        'switch': '.switch',
        'auto_open_class': 'open',
        'events': {}
      }, options);
      return this.each(function() {
        var branchNodes, tree;
        tree = $(this);
        tree.off('.tree');
        branchNodes = tree.find(options.node).find(options.branch).hide().end().has(options.branch).addClass(options.branch_class);
        if ($.isFunction(options.auto_switch_add) === true) {
          options.auto_switch_add(branchNodes);
        }
        tree.find("." + options.auto_open_class).parents(options.branch).not(tree).show();
        tree.on('click.tree', "" + options["switch"], function(e) {
          var method, node, subtree;
          e.stopPropagation();
          node = $(this).closest(options.node);
          subtree = node.children(options.branch);
          if (subtree.size() === 1) {
            subtree.toggle();
          }
          method = subtree.is(':visible') ? 'show' : 'hide';
          subtree.find("" + options.node + "." + options.branch_class)[method]();
          return node.trigger('tree.branch_toggle', {
            'visible': subtree.is(':visible')
          });
        });
        return $.each(options.events, function(def, fnc) {
          var events, parts, selector;
          parts = def.split(' ');
          events = parts.shift().split(',');
          events = $.each(events, function(event) {
            return event + '.tree';
          }).join(' ');
          selector = parts.join(' ');
          if (selector !== void 0) {
            return tree.on(events, selector, fnc);
          }
        });
      });
    };
  })(jQuery);

}).call(this);
